<html><head>
<title>Установление исходящих соединений</title>
		    <style type="text/css">
A.noneline { font-family: Arial, Serif; text-decoration: none; }
FONT.arial { font-family: Arial, Serif; }
TD.arial   { font-family: Arial, Serif; }
TH.arial   { font-family: Arial, Serif; }
PRE        { font-family: Monospace; color: navy; }
SAMP       { font-family: Monospace; color: navy; }
TT         { font-family: Monospace; color: navy; }
VAR        { font-family: Monospace; color: navy; }
</style>
</head>
<body bgcolor="#FFF5EE" text="#000000" link="#FF0000" alink="#FF0000" vlink="#A52A2A">
<basefont size="3">
<h3 align=center>Глава 4. Установление исходящих соединений<br>
(как позвонить другому модему)</h3>
<p align=justify>В этой  главе описаны команды,  используемые для вызова
удаленного модема, когда Ваш компьютер работает в режиме имитации  терминала.  (В руководстве по вашему телекоммуникационному
программному обеспечению должно быть описано как перевести  его
в этот режим.) Разделы настоящей главы включают:
<ul>
<li>установление исходящих соединений;
<li>режимы набора номера;
<li>использование тонального и импульсного набора номера;
<li>паузы и ожидания при наборе номера;
<li>набор  номера при установлении соединения через местную АТС;
<li>"только вызывающий" и "только отвечающий" модем;
<li>набор номера телефона, находящегося в памяти;
<li>автоматический набор номера при установлении  голосового соединения;
<li>передача тонов как данных;
<li>автоматический перенабор последнего набранного номера;
<li>переадресация вызова;
<li>ручной набор номера;
<li>разъединение;
<li>список S-регистров, влияющих на набор номера.
</ul>
<a name=1></a>
<h4>Установление исходящих соединений</h4>
<p>Чтобы вызвать удаленный модем:
<ol>
<li>Наберите ATDxxxxxxx,  где xxxxxxx номер абонента, на
модем  которого  Вы звоните,  включая модификаторы (если той же
командной строке Вы хотите задать какие-либо другие команды набирайте их перед командой набора номера).
<p>Например команда набора номера может выглядеть так:
<pre>
         ATDP 8W (095) 924-3018
</pre>
где P - модификатор импульсного набора номера,  W - модификатор
ожидания второго непрерывного сигнала,  (095)924-3018  -  номер
абонента.
<li>Нажмите клавишу &lt;Enter&gt;
</ol>
<p align=justify>После окончания  набора  номера,  модем  ожидает ответа
удаленного модема до истечения интервала  времени,  задаваемого
регистром S7.  Если за указанный интервал времени Ваш модем получил ответ, то оба модема начинают обмениваться последовательностью  подтверждающих сигналов для настройки параметров.  Если
фаза  установления  соединения  завершена  успешно,  начинается
собственно  передача  данных и Ваш модем переходит в режим данных.
<p align=justify>Если после набора номера получен сигнал "Занято", можно
повторить набор используя команду A/.
<p>Передача данных прекращается в следующих случаях:
<ul>
<li>модем теряет сигнал несущей удаленного модема;
<li>модему послана команда "отбой";
<li>Ваш  модем обнаруживает состояние "Off" интерфейсного
        сигнала DTR и ему были выданы команды &D2 или &D3;
<li>телекоммуникационная программа выполняет "разрыв соединения"  (см.  Руководство по программному обеспечению).
</ul>
<p align=justify>При этом модем разрывает соединение, возвращается в командный  режим  и  выдает сообщение "NO CARRIER" ("потеря несущей").
<a name=2></a>
<h4>Режимы набора номера</h4>
<ul type=disk>
<li><a href=#2_1>Режим X0</a>
<li><a href=#2_2>Режим X1</a>
<li><a href=#2_3>Режим X2</a>
<li><a href=#2_4>Режим X3</a>
<li><a href=#2_5>Режим X4</a>
</ul>
<p align=justify>Модем может работать в одном из пяти режимов,  задаваемых командой Xn.  Каждый из этих режимов  предусматривает  свой
метод набора номера и каждому из них соответствует определенный
набор сообщений,  которые может выдавать модем в ответ на  введенную команду или в ответ на возникшую ситуацию,  например обнаружение сигнала "занято" или установление соединения. Сообщения модема описаны в <a href=gl3.htm>Главе 3</a>.
<p align=justify>Ниже описаны эти режимы и указано, какие наборы сообщений модема им соответствуют.
<a name=2_1></a>
<p align=justify><i>Режим X0</i><br>
Набор ответов режима X0 включает в себя первые пять сообщений, приведенных в <a href=gl3.htm#t3_1>Таблице 3-1</a>. (Т.е. сообщения 0, 1, 2, 3,
4 ,5 или соответствующие им текстовые.) При работе в режиме X0,
в случае успешного установлении соединения,  вы будете получать
сообщение  "CONNECT",  без указания на какой скорости произошло
соединение.
<p align=justify>В этом режиме модем игнорирует любые сигналы АТС -  через  две  секунды  (этот  интервал задается регистром S6) после
ввода команды D модем начнет набор номера,  вне зависимости  от
того, был ли обнаружен непрерывный сигнал станции. При этом так
же отключается определение сигнала "занято" - модем всегда  будет  ждать  ответа  удаленного модема до истечения регистра S7,
игнорируя состояние телефонной линии.
<p align=justify>Такой режим набора номера называется набором вслепую (blind dial).  Набор вслепую может быть рекомендован для использования с
ATC, которые выдают нестандартный или очень тихий сигнал "набирайте" (непрерывный гудок),  или вообще не выдают никакого сигнала, как некоторые мини-АТС.
<a name=2_2></a>
<p align=justify><i>Режим X1</i><br>
Этот режим отличается от режима X0 только набором ответов модема - при установлении соединения к слову CONNECT  будет
добавлено число указывающее скорость в бит/с,  т.е возможны ответы модема 0-5,  а так же 10 и выше. (см <a href=gl3.htm#t3_1>Табл. 3-1</a>). Набор номера также производится вслепую.
<a name=2_3></a>
<p align=justify><i>Режим  X2</i><br>
Набор сообщений режима X2 включает сообщения 0-6,  10 и
выше.
<p align=justify>В этом  случае перед набором номера модем будет ожидать
непрерывного гудка (сигнала "набирайте").  В случае  отсутствия
сигнала  "набирайте"  в течение 10 секунд (это время задается в
регистре S75, см. Приложение B) набор номера будет прерван, модем  выдаст  сообщение NO DIALTONE ( "Нет сигнала 'набирайте'")
или 6, если установлен режим числовых ответов.
<a name=2_4></a>
<p align=justify><i>Режим X3</i><br>
Набор сообщений режима X3 включает те же сообщения 0-5,
10 и выше, что и набор X1, а так же сообщение 7.
<p align=justify>В этом режиме используется "слепой" набор номера.  Если
после набора номера модем обнаруживает сигнал "занято", выдается сообщение BUSY или 7 в режиме числовых ответов.
<a name=2_5></a>
<p align=justify><i>Режим X4</i><br>
Этот режим устанавливается по умолчанию.
<p align=justify>В этом  режиме  модем  определяет и сигнал "занято",  и
сигнал "набирайте". Допустимы любые сообщения из <a href=gl3.htm#t3_1>Табл. 3-1</a>.
<p align=justify>Таким образом,  режим X0 используется,  как правило,  с
устаревшим программным обеспечением, не способным корректно обрабатывать сообщения модема,  отличные от CONNECT и NO CARRIER.
Режимы X1,  X2 и X3 используются при работе на линиях, выдающих
нестандартные сигналы или не выдающих сигналов вообще. Режим X1
используется для отключения  обнаружения  сигналов  "занято"  и
"набирайте",  X2 - для отключения обнаружения сигнала "занято",
а X3 - сигнала "набирайте".  В обычных случаях используется режим X4.
<a name=3></a>
<h4>Набор номера. Модификаторы команды набора номера.</h4>
<p align=justify>В данном разделе описаны  модификаторы  набора  номера,
которые могут присутствовать в команде набора номера.
<table border=1>
<tr valign=top><th>Модификатор<th>Функция и пример</tr>
<tr valign=top><th>T<td>Тональный (DTMF) набор номера<br>
Перед цифрами номера ставиться буква T<br>
Пример: <tt>ATDT 555-1212</tt>
</tr>
<tr valign=top><th>P<td>Импульсный набор<br>
Перед цифрами номера ставиться буква P<br>
Пример: <tt>ATDP 555-1212</tt>
</tr>
<tr valign=top><th>W<td>Ожидание второго сигнала "ответ станции"<br>
Этот модификатор используется
при наборе номеров абонентов,
требующих ожидания второго
сигнала "ответ станции"
например при междугородных
звонках или при выходе в город
через офисную АТС.
<p>Например для выхода в город через  местную  АТС  обычно
нужно набрать 9 и, дождавшись непрерывного гудка городской АТС,
набирать номер городского абонента. В этом случае команда набора номера может иметь вид:
<pre>
ATDT 9W P 555-1212
</pre>
что означает  "набрать тональным сигналом цифру '9',  дождаться
гудка "набирайте" от городской АТС (модем будет ожидать  его  в
течение времени,  задаваемого регистром S74,  по умолчанию - 20
секунд), набрать импульсным методом городской номер.
<p>
Аналогично, при звонке в другой город <pre>
ATDP8W (812) - 555-12-12
</pre>
</tr>
<tr valign=top><th>R<td>Вызов с использованием тона "ответ"<br>
Если на конце командной строки стоит
модификатор R, при установлении соединения с удаленным модемом Ваш модем
вместо тона "вызов" будет  использовать тон "ответ". Этот  модификатор
следует использовать для установления
исходящих соединений  с  устаревшими
модемами, не  имеющими режима ответа.
Внимание! При разборе командной строки, любые символы, набранные после R,
игнорируются.<br>
Например: <tt>ATDP555-12-12R</tt>
</tr>
<tr valign=top><th>&Zn=xxx<td>Запомнить номер в памяти<br>
здесь xxx - номер телефона, n - адрес
ячейки памяти, куда записывается номер
Для записи номеров доступны 4 ячейки с
номерами 0,1,2 и 3, таким образом, Вы
можете запомнить до четырех номеров в
памяти  модема, а потом вызывать их
оттуда при помощи команды DS<br>
Например:
<pre>
AT&Z0=555-1212
</pre>
Выполнение этой команды приводит к тому, что номер 555-1212 будет сохранен в ячейке с адресом 0.
</tr>
<tr valign=top><th>ATDS=n<td>Набор номера, записанного в памяти модема<br>
По этой команде модем будет производить набор номера записанного в ячейке памяти n. Как указывалось выше (см.
описание модификатора &Zn=xxx)  для
хранения номеров доступны 4 ячейки c
адресами 0,1,2 и 3.<br>
Например:
<pre>
ATDS0=1
</pre>
Здесь модем будет производить набор номера, записанного в ячейке с адресом 1.
</tr>
<tr valign=top><th>@<td>Доступ к системе с перевызовом.<br>
Модификатор @ говорит модему, что,
перед тем как продолжать выполнение
действий, указанных далее в командной строке, следует дождаться отсутствия каких либо сигналов в линии в
течении 5 с.
<p>
Иногда для  доступа  к удаленным системам применяется следующий
прием:  Вы звоните на удаленную систему. Удаленная система снимает трубку и ожидает, когда ей передадут номер телефона (обычно сигналами тонального набора). Далее удаленная система отсоединяется, и проверяет, есть ли среди номеров абонентов, имеющих
к ней доступ, номер Вашего телефона. Если доступ с Вашего телефона  разрешен,  то  удаленная  система перезванивает Вам сама,
после чего Вы обычным образом устанавливаете с ней  соединение.
Такой прием называется "callback" - обратный вызов.<br>
Например:
<pre>
ATDP555-1212 @ T555-1515,;H
</pre>
означает следующее:  Модем  импульсным  набором  набирает номер
555-1212 (системы с обратным вызовом), ждет пока система снимет
трубку, определяя это по отсутствию в линии каких либо сигналов
в течении 5 с.  Далее модем тоном передает свой номер 555-1515.
Запятая говорит, что модем должен ждать 2 с, после чего возвратиться в командный режим (точка с запятой - возврат в командный
режим) и разорвать соединени (команда H в конце строки).
</tr>
<tr valign=top><th>;<td>Возврат в командный режим<br>
Модификатор ; приводит к   возврату
в командный режим после набора номера. Эта особенность может использоваться, например,  для  телефонного
разговора с оператором удаленной системы, передачи данных или для набора
очень длинных номеров,  превышающих
40-символьный лимит.<br>
Например:
<pre>
ATDP555-1212;
</pre>
Модем наберет номер и возвратится в командный режим. Вы, в свою
очередь,  услышав ответ оператора,  можете снять трубку  своего
телефонного аппарата и перейти к разговору с оператором,  предварительно набрав команду ATH. После окончания разговора с оператором,  для перехода в режим данных введите команду ATX1D без
параметров и повесьте трубку.  (X1 используется для  отключения
обнаружения сигналов АТС,  так как соединение уже установлено).
Услышав вызывной тон Вашего модема,  оператор удаленного модема
наберет  ATA  и повесит трубку своего аппарата.  ( Пользователи
модемов IDC-1414BXL и IDC-1914BXL могут вместо этих команд  использовать клавиши V/D и ORG/ANS). Если требуется разорвать соединение, введите команду ATH.
</tr>
<tr valign=top><th>!<td>Переадресация сообщений.<br>
Некоторые оффисные АТС воспринимают 
кратковременный разрыв линии абонента как команду переадресации данного
соединения на другой номер. Eсли вы
работаете с такой АТС, то для переадресации можно использовать модификатор ! .<br>
Пример: команда
<pre>
AT D!
</pre>
на некоторых офисных ATC может быть использована для "подбора"
абонента, звонящего по другой линии.
</tr>
</table>
<a name=4></a>
<h4>Ручной набор номера</h4>
<p align=justify>Если по каким либо причинам  невозможно  использовать
автоматический набор номера (например, необходимо предварительно договориться голосом с абонентом),  Вы можете набирать номер
с телефонного аппарата, подключенного к Вашему модему.
<p align=justify>Ниже описано,  как работать с модемом при ручном наборе номера.
<ol>
<li>Поднимите трубку Вашего телефонного аппарата.  Модем  должен
при этом находится в командном режиме.
<li>Наберите вручную номер удаленного модема. Если трубку снимет
оператор - попросите его перевести свой модем в режим ответа.
<li>Услышав высокочастотный тон "ответ" удаленного модема, наберите ATX1D и нажмите &lt;Enter&gt;.
<li>Повесьте трубку. Модемы перейдут в режим установления соединения.
</ol>
<a name=5></a>
<h4>Разрыв соединения</h4>
<p align=justify>Чтобы разорвать соединение  после  завершения  передачи
данных, необходимо сделать следующее
<ol>
<li>Для перехода из режима данных в режим команд, наберите Escape-последовательность,  (по умолчанию "+++").  Модем вернется в
режим команд и выдаст сообщение OK.
<li>Модем будет готов к приему очередных команд через время, заданное в регистре S12 (стандартно 1с).
<li>Введите команду ATH.  Не забудьте завершить ее нажатием клавиши  &lt;Enter&gt;.  Модем  при этом отсоединится от линии ("положит
трубку"), выдаст Вам сообщение OK и вернется в командный режим.
</ol>
<p align=justify>Если Ваше коммуникационное ПО имеет специальную команду
для разрыва соединения, Вы можете так же воспользоваться ей.
<a name=6></a>
<h4>Регистры, влияющие на набор номера</h4>
<p align=justify>Параметры, влияющие на набор номера хранятся в регистрах модема
с именами S6,  S7,  S8,  S9, S10, а так же в регистрах S70-S81.
<table border=1>
<tr valign=top><th>регистр<th>значение по умолчанию<th>описание функции</tr>
<tr valign=top><td>S6<td align=center>2 c<td>Максимальное время ожидания сигнала "ответ станции"</tr>
<tr valign=top><td>S7<td align=center>30 с<td>Время ожидания тона "ответ" удаленного модема после набора номера</tr>
<tr valign=top><td>S8<td align=center>2 с<td>Длительность паузы соответствующая модификатору "," команды набора номера</tr>
<tr valign=top><td>S9<td align=center>600 мс<td>Время детектирования тона "ответ"
удаленного модема. Если Ваш модем
слышит непрерывный "ответ" дольше,
чем время указанное в  S9  то  он
считает что   удаленный модем ему
ответил, иначе - что ответа нет.</tr>
<tr valign=top><td>S10<td align=center>1.4 c<td>Время ожидания перед отбоем после
потери несущей.  Если в  процессе
передачи данных  ваш модем теряет
несущую, то перед тем как отработать отбой он будет ожидать ее появления в течении времени, указанное в S10</tr>
</table>
<p><center><p>
<font size=-1>
<a href="gl3.htm">Назад</a> | <a href="index.htm">Содержание</a> | <a href="gl5.htm">Вперед</a></font></center></p>
</p>
<hr noshade>
<center>
<font size=1 class=arial>
Copyright &copy; <a href="http://www.citmgu.ru/" class=noneline>CIT</a>
</font></center></body></html>
