<html><head>
<title>Управление модемом</title>
		    <style type="text/css">
A.noneline { font-family: Arial, Serif; text-decoration: none; }
FONT.arial { font-family: Arial, Serif; }
TD.arial   { font-family: Arial, Serif; }
TH.arial   { font-family: Arial, Serif; }
PRE        { font-family: Monospace; color: navy; }
SAMP       { font-family: Monospace; color: navy; }
TT         { font-family: Monospace; color: navy; }
VAR        { font-family: Monospace; color: navy; }
</style>
</head>
<body bgcolor="#FFF5EE" text="#000000" link="#FF0000" alink="#FF0000" vlink="#A52A2A">
<basefont size="3">
<h3 align=center>Глава 3. Управление модемом</h3>
<p align=justify>В главе 3 описан формат AT-команд.  Здесь также описаны возможные  сообщения,  выдаваемые модемом в ответ на введенную команду.
<p align=justify>Обычно пользователи работают с модемом посредством  развитых
телекоммуникационных  программами,  в этом случае нет необходимости управлять модемом посредством AT-команд напрямую и анализировать непосредственные ответы модема. Программа сама посылает команды и обрабатывает сообщения модема. Иными словами, весь
интерфейс низкого уровня скрыт от пользователя, которому обычно
не важно, что именно телекоммуникационный пакет посылает модему
и какие сообщения получает в ответ,  для того, чтобы, например,
передать файл или положить письмо в ящик электронной почты, так
как Вас,  как правило, интересует конечный результат, а не способ его достижения.
<p align=justify>Впрочем, если Вам по каким либо причинам требуется управлять
модемом напрямую, то сведения изложенные в настоящей главе окажутся как нельзя кстати.
<a name=1></a>
<h4>Ввод команд</h4>
<ul type=disk>
<li><a href=#1_1>Как исправить неправильно набранную команду</a>
<li><a href=#1_2>Как набирать команды в виде, наиболее удобном для восприятия</a>
<li><a href=#1_3>Ввод командных строк длиной более сорока символов</a>
<li><a href=#1_4>Пропуск параметров (параметры по умолчанию)</a>
<li><a href=#1_5>Повторное выполнение командной строки</a>
<li><a href=#1_6>Сведения о командах</a>
</ul>
<p align=justify>С помощью  AT-команд Вашему модему можно приказать исполнять
большое количество разнообразных функций, среди которых - набор
номера,  ответ удаленному модему, действия по передаче факсов и
многие другие.  Однако,  модем воспринимает AT-команды тогда  и
только тогда, когда он находится в командном режиме.
<p>Чтобы ввести AT-команду, сделайте следующее:
<ol>
<li>Наберите AT в латинском регистре (вообще,  всюду в данном
документе все символы команд набираются в латинском  регистре).
Эти  две  буквы  всегда должны стоять в начале командной строки
(за исключением случая A/,  описанного ниже). Допустимо использовать или заглавные, или строчные буквы, но не те и другие одновременно ( AT или at, но не At)
<li>Наберите команду или подряд несколько команд,  которые Вы
хотите исполнить. Длина командной строки не должна превышать 40
символов.
<li>Нажмите клавишу &lt;Enter&gt;.  Модем выполнит командную строку
и выдаст сообщение о результате.
</ol>
<a name=1_1></a>
<p><i>Как исправить неправильно набранную команду.</i>
<p align=justify>Если при наборе команды вы обнаружили ошибку, то для ее исправления  следует клавишей &lt;BackSpace&gt; ("забой") стереть неверные символы и набрать остаток командной  строки  заново.  Таким
способом  можно исправлять любые неверно набранные команды,  за
исключением самого префикса AT.
<a name=1_2></a>
<p><i>Как набирать команды в виде, наиболее  удобном для восприятия.</i>
<p align=justify>Чтобы сделать набранную командную строку более удобочитаемой
и, тем самым, избежать возможных ошибок, допустимо отделять отдельные команды и поля параметров знаками препинания и пробелами.  В любом месте командной строки допускается ставить пробел.
В телефонном же номере допустимы кроме пробелов и знаки скобок,
и дефис.<br>
Например:<pre>
  AT M3 DT 9, 1 (818)555-1234
</pre><p align=justify>
При разборе командной строки модем игнорирует пробелы и указанные знаки препинания. Однако, длина строки команд вместе с этими знаками не должна превышать 40-символьный лимит.
<a name=1_3></a>
<p><i>Ввод командных строк длиной более 40 символов</i>
<p align=justify>Если Вы  хотите ввести строку длиной более 40 символов,  вам
придется разбить ее на две отдельные строки  и  вводить  каждую
отдельно. В случае, если требуется ввести очень длинную команду
набора номера D (к примеру,  команда для набора номера и выдачи
тонового пароля может оказаться значительно длиннее),  наберите
сначала первую часть номера,  длиной до 39 символов  (вместе  с
самой  командой AT,  D и прочими символами),  в конце поставьте
';' и нажмите &lt;Enter&gt;.  При этом модем,  исполнив команду, вернется в командный режим и Вы сможете набрать еще одну команду D
с оставшейся частью номера.
<a name=1_4></a>
<p><i>Пропуск параметров (параметры по умолчанию)</i>
<p align=justify>Некоторые команды требуют задания числовых параметров, однако
при вводе эти параметры можно опустить,  тогда модем,  исполняя
команду,  будет  использовать параметр,  принятый по умолчанию.
Везде в этом документе, где явно не указано иное, значением параметра по умолчанию является 0.
<p align=justify>Например, команда Q - "Задать режим выдачи ответов" имеет параметр 0 или 1.
<p>Q0 - говорит модему,  что тот обязан сопровождать каждую  выполняемую команду подтверждающим сообщением.
<br>Q1 - запрещает какие либо подтверждения.
<br>При этом  ввод Q без параметра (например AT Q<Enter>) эквивалентен Q0.
<p align=justify>Другим хорошим примером является строка  инициализации,
используемая программой MTEZ с некоторыми модемами, часто вызывающая удивление пользователей:
<pre>
  AT S=Q
</pre>
<p align=justify>
которую можно записать в более понятном виде,  как AT  S0=0  Q0
(т.е.  запретить  автоматический ответ и разрешить выдачу подтверждений).
<a name=1_5></a>
<p><i>Повторное выполнение командной строки.</i>
<p align=justify>Следует отметить,  что  последняя введенная командная строка
хранится в памяти модема до тех пор, пока ее не заменит следующая  команда.  Поэтому имеется возможность повторить исполнение
последней командной строки. Для этого служит специальная команда  A/.  Поскольку при выключении питания или аппаратном сбросе
содержимое буфера командной строки разрушается, очевидно, что в
этом случае пытаться повторить последнюю командную строку бессмысленно.
<blockquote>
<p align=justify>Внимание! Команда A/ набирается без стандартного префикса AT
и  не завершается клавишей <Enter>.  Просто наберите A/ и модем
автоматически выполнит предыдущую команду.
</blockquote>
<p align=justify>Команда A/ обычно используется для повторного  выполнения длинной команды или для перенабора телефонного номера,  который был занят.
<p align=justify>Команду A/ можно использовать неоднократно, до тех пор,
пока  не  будет набрана новая командная строка,  начинающаяся с
AT, или не произойдет сброс модема или выключение питания.
<a name=1_6></a>
<p><i>Сведения о командах.</i>
<p align=justify>Теперь, когда  вы  знаете,  что такое команды и как они
задаются,  обратитесь к следующим главам для  полного  описания
доступных команд.
<ul>
<li>Команды для вызова удаленного модема описаны в <a href=gl4.htm>Главе 4</a>.
<li>Команды,  используемые при ответе на звонок удаленного модема, описаны в <a href=gl5.htm>Главе 5</a>.
<li>Команды работы с протоколами исправления ошибок и сжатия
данных описаны в <a href=gl7.htm>Главе 7</a>.
</ul>
<a name=2></a>
<h4>Сообщения модема</h4>
<ul type=disk>
<li><a href=#2_1>Текстовые и числовые сообщения</a>
<li><a href=#2_2>Наборы сообщений</a>
<li><a href=#2_3>Сообщения модема при работе с протоколами коррекции ошибок и сжатия данных</a>
</ul>
<p align=justify>Когда Вы послыаете модему какую-либо команду, модем выдает в ответ сообщение - обычно OK.  Вы можете никогда не  увидеть  этих  сообщений,  так  как некоторые телекоммуникационные
программы перехватывают и самостоятельно  обрабатывают  сообщения,  до того,  как они могут быть выведены на дисплей. Однако,
если Вы собираетесь непосредственно управлять модемом,  Вам необходимо знать, какие сообщения и в каких случаях выдает модем.
<p align=justify>В данном  разделе  рассматриваются  все виды сообщений,
выдаваемые модемом.
<a name=2_1></a>
<p><i>Текстовые и числовые сообщения</i>
<p align=justify>Модем, в  зависимости  от настроек,  может посылать два
типа сообщений - в виде текста и в виде  чисел  (соотвественно,
называемые текстовыми или числовыми сообщениями). Каждому текстовому сообщению однозначно соответствует числовое и  наоборот.
Как правило, большинство программ и пользователей, работающих с
модемом непосредственно, используют более удобные текстовые сообщения,  на которые модем настроен по умолчанию. Однако в этом
тексте для краткости иногда будут указаны только  соответствующие им числовые сообщения. (См. Табл. 3-1).
<p align=justify>Если Ваше  программное обеспечение требует числовых ответов,
то перевести модем в этот режим можно при помощи команды V0.
<p align=justify>Запретить получение каких либо ответов вообще (например, для
модема, подключенного к принтеру) можно командой Q1.
<a name=2_2></a>
<p><i>Наборы сообщений</i>
<p align=justify>Модем может работать в одном из пяти режимов,  задаваемых  командой  Xn.  Каждый из этих режимов предусматривает свой
метод набора номера и каждому из них соответствует определенный
набор  сообщений,  которые может выдавать модем в ответ на введенную команду или в ответ на возникшую ситуацию,  например обнаружение сигнала "занято" или установление соединения. Так как
команда Xn влияет не только на вид сообщений модема,  но  и  на
метод  набора  номера,  описание этой команды и соответствующих
сообщений находится в <a href=gl4.htm>Главе 4</a>,  в разделе "Методы набора  номера".
<a name=2_3></a>
<p><i>Сообщения модема при работе с протоколами коррекции ошибок и сжатия данных</i>
<p align=justify>Ваш модем поддерживает протоколы исправления  ошибок  и
сжатия данных MNP и V.42/V.42bis. При работе с этими протоколами модем выдает дополнительные сообщения,  перечисленные в <a href=#t3_1>Таблице 3-1</a>. Чтобы разрешить выдачу расширенного набора сообщений,
следует пользоваться командой Wn.
<blockquote>
<p align=justify>Внимание!  Команду W,  разрешающую выдачу расширенных
сообщений при прохождении фазы выбора протокола коррекции-сжатия данных в момент установления соединения между двумя модемами, следует отличать от модификатора W в
команде D (набор номера).
</blockquote>
<p align=justify>По умолчанию принимается установка W0,  запрещающая выдачу расширенного набора ответов, если регистр S95=0 (заводская
установка).  В режиме W0 все сообщения "CONNECT XXXX" соответствуют  скорости обмена данными между модемом и Вашим терминалом
(DTE speed).
<p align=justify>Командой W1 разрешается выдача  сообщений  "CARRIER"  и
"PROTOCOL". В этом режиме сообщения "CONNECT XXXX" также указывают скорость обмена данными с терминалом, последнее справедливо в случае, если регистр S95=0.
<p align=justify>Если Вы желаете,  чтобы сообщение "CONNECT XXXX" указывало физическую скорость передачи данных в канале  (DCE  speed)
вместо  скорости обмена с терминалом,  введите команду W2.  Эта
команда запрещает выдачу расширенного набора ответов,  если регистр S95=0.
<p align=justify>Модемы, поддерживающие  протоколы  исправления ошибок и
сжатия данных MNP и V.42/V.42bis,  обрабатывают  также  команду
\V1. В этом режиме все сообщения "CONNECT" будут содержать суффикс /ARQ,  если модем установил  соединение  с  использованием
протокола коррекции ошибок. Этот режим устанавливается по умолчанию.
<blockquote>
<p align=justify>Внимание! Многие программы могут работать некорректно в
режиме W1, а некоторые - и в режиме W2, поэтому не рекомендуется изменять заводские настройки,  если вы не уверены,  что ваша
программа способна работать с расширенными сообщениями.  С другой стороны, коммуникационные программы, использующие современные протоколы передачи файлов (например,  Zmodem),  могут работать неустойчиво, если установлен режим W0 или отсутствуют суффиксы /ARQ в режиме W2.
</blockquote>
<a name=t3_1></a>
<p><center>Таблица 3-1
<table width=100% border=1>
<tr valign=top><th>Сообщение модема<th>Сообщение в числовой форме<th>Значение сообщения</tr>
<tr valign=top><td>OK<td align=center>0<td>Комманда выполнена успешно</tr>
<tr valign=top><td>CONNECT<td align=center>1<td>Если модем находится в состоянии, отличном от X0, данное сообщение означает, что установлено соединение со скоростью 300 bps. В состоянии X0 оно означает, что было установленно соединение с удаленным модемом на произвольной скорости.</tr>
<tr valign=top><td>RING<td align=center>2<td>Модем обнаружил входящий звонок</tr>
<tr valign=top><td>NO CARRIER<td align=center>3<td>Потеряна (или не обнаружена в процессе установления соединения) несущая удаленного модема.</tr>
<tr valign=top><td>ERROR<td align=center>4<td>Была введена неверная или недопустимая в данном режиме команда, произошел сбой аппаратуры модема или длинна коммандной строки превысила 40 символов</tr>
<tr valign=top><td>CONNECT 1200<td align=center>5<td>Установленно соединение на скорости 1200 bps (в режиме X0 не выдается)</tr>
<tr valign=top><td>NO DIALTONE<td align=center>6<td>Модем не обнаружил непрерывного гудка (сигнала "набирайте"). Сообщение выдается только в режимах X2 и X4, а так же в любом режиме, если использован символ 'W' в команде набора номера.</tr>
<tr valign=top><td>BUSY<td align=center>7<td>Модем обнаружил короткие гудки (сигнал "занято"). Это сообщение не выдается в режимах X0, X1, X2, так как определение сигнала "занято" в этих режимах не производится.</tr>
<tr valign=top><td>NO ANSWER<td align=center>8<td>Модем не обнаружил "тишину" в линии, когда был использован символ '@' в команде набора номера.</tr>
<tr valign=top><td>CONNECT 2400<td align=center>10<td>Установленно соединение на скорости 2400 bps (в режиме X0 не выдается)</tr>
<tr valign=top><td>CONNECT 4800<td align=center>11<td>Установленно соединение на скорости 4800 bps</tr>
<tr valign=top><td>CONNECT 9600<td align=center>12<td>Установленно соединение на скорости 9600 bps</tr>
<tr valign=top><td>CONNECT 14400<td align=center>13<td>Установленно соединение на скорости 14400 bps</tr>
<tr valign=top><td>CONNECT 19200<td align=center>14<td>Установленно соединение на скорости 19200 bps</tr>
<tr valign=top><td>CONNECT 16800<td align=center>15<td>Установленно соединение на скорости 16800 bps</tr>
<tr valign=top><td>CONNECT 38400<td align=center>16<td>Установленно соединение на скорости 38400 bps</tr>
<tr valign=top><td>CONNECT 57600<td align=center>18<td>Установленно соединение на скорости 57600 bps</tr>
<tr valign=top><td>CONNECT 1200/REL<td align=center>22<td>Установлено соединение с коррекцией ошибок на скорости 1200 bps</tr>
<tr valign=top><td>CONNECT 2400/REL<td align=center>23<td>Установлено соединение с коррекцией ошибок на скорости 2400 bps</tr>
<tr valign=top><td>CONNECT 4800/REL<td align=center>24<td>Установлено соединение с коррекцией ошибок на скорости 4800 bps</tr>
<tr valign=top><td>CONNECT 9600/REL<td align=center>26<td>Установлено соединение с коррекцией ошибок на скорости 9600 bps</tr>
<tr valign=top><td>CONNECT 19200/REL<td align=center>27<td>Установлено соединение с коррекцией ошибок на скорости 19200 bps</tr>
<tr valign=top><td>CONNECT 38400/REL<td align=center>28<td>Установлено соединение с коррекцией ошибок на скорости 38400 bps</tr>
<tr valign=top><td>CARRIER 300<td align=center>40<td>Скорость обмена с удаленным модемом 300 bps</tr>
<tr valign=top><td>CARRIER 1200/75 V.23<td align=center>44<td>Скорость передачи 1200 bps, скорость приема - 75 bps</tr>
<tr valign=top><td>CARRIER 75/1200 V.23<td align=center>45<td>Скорость передачи 72 bps, скорость приема - 1200 bps</tr>
<tr valign=top><td>CARRIER 1200<td align=center>46<td>Скорость обмена с удаленным модемом 1200 bps</tr>
<tr valign=top><td>CARRIER 2400<td align=center>47<td>Скорость обмена с удаленным модемом 2400 bps</tr>
<tr valign=top><td>CARRIER 4800<td align=center>48<td>Скорость обмена с удаленным модемом 4800 bps</tr>
<tr valign=top><td>CARRIER 7200<td align=center>49<td>Скорость обмена с удаленным модемом 7200 bps</tr>
<tr valign=top><td>CARRIER 9600<td align=center>50<td>Скорость обмена с удаленным модемом 9600 bps</tr>
<tr valign=top><td>CARRIER 12000<td align=center>51<td>Скорость обмена с удаленным модемом 12000 bps</tr>
<tr valign=top><td>CARRIER 14400<td align=center>52<td>Скорость обмена с удаленным модемом 14400 bps</tr>
<tr valign=top><td>CARRIER 16800<td align=center>52<td>Скорость обмена с удаленным модемом 16800 bps (только для IDC-19xx)</tr>
<tr valign=top><td>CARRIER 19200<td align=center>52<td>Скорость обмена с удаленным модемом 19200 bps (только для IDC-19xx)</tr>
<tr valign=top><td>COMPRESSION: CLASS 5<td align=center>66<td>Установлен протокол сжатия данных MNP-5</tr>
<tr valign=top><td>COMPRESSION: V.42 BIS<td align=center>67<td>Установлен протокол сжатия данных V.42bis</tr>
<tr valign=top><td>COMPRESSION: NONE<td align=center>69<td>Протокол сжатия данных не установлен</tr>
<tr valign=top><td>PROTOCOL: NONE<td align=center>70<td>Асинхронный режим, без коррекции ошибок</tr>
<tr valign=top><td>PROTOCOL: LAPM<td align=center>77<td>Установлен протокол коррекции ошибок V.42 LAPM</tr>
<tr valign=top><td>PROTOCOL: ALT<td align=center>80<td>Установлен протокол коррекции ошибок MNP</tr>
<tr valign=top><td>PROTOCOL: MNP 2,4<td align=center>81<td>Установлен байт- ориентированный протокол коррекции ошибок MNP 4</tr>
<tr valign=top><td>PROTOCOL: MNP 3,4<td align=center>82<td>Установлен бит-ориентированный протокол коррекции ошибок MNP 4</tr>
<tr valign=top><td>COMPRESSION: MNP 5<td align=center>83<td>Установлен протокол сжатия данных MNP 5</tr>
</table>
<p><center><p>
<font size=-1>
<a href="gl2.htm">Назад</a> | <a href="index.htm">Содержание</a> | <a href="gl4.htm">Вперед</a></font></center></p>
</p>
<hr noshade>
<center>
<font size=1 class=arial>
Copyright &copy; <a href="http://www.citmgu.ru/" class=noneline>CIT</a>
</font></center></body></html>
